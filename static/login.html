<!doctype html>
<html lang="en-AU">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Login page">
    <meta name="generator" content="Hugo 0.87.0">
    <title>Login</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.1/examples/sign-in/">

    <!-- Bootstrap core CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="css/styles.css" rel="stylesheet">
  </head>
  <body class="text-center">
    <header>
      <div class="topnav">
          <a href="./homepage.html"><i class="material-icons">home</i>Home</a> 
          <a href="./menu.html"><i class="material-icons">list_alt</i>Menu</a>
          <a class="active" href="./login.html"><i class="material-icons">login</i>Log In</a>
          <a href="./signup.html"><i class="material-icons">how_to_reg</i>Sign Up</a>
      </div>
  </header>
    <main class="form-signin">
      <form action = "/login" method = "post" id = "login-form">
        <h1>Welcome to</h1>
        <h3>Le Bistrot d'Andre</h3>

        <div class="form-floating">
          <input type="text" class="form-control" id="floatingInput" placeholder="username">
          <label for="floatingInput">Email Address/Username</label>
        </div>
        <div class="form-floating">
          <input type="password" class="form-control" id="floatingPassword" placeholder="Password">
          <label for="floatingPassword">Password</label>
        </div>

        <div class="checkbox mb-3">
          <label>
            <input type="checkbox" value="remember-me"> Remember me
          </label>
        </div>
        <button class="w-100 btn btn-lg btn-primary" type="submit">Login</button>

        <a href="signup.html">Create new account</a>
      </form>
    </main>

  <script>
    const form = document.getElementById("login-form")
    form.addEventListener("submit", login)

    async function login(event) {
      event.preventDefault()
      const username = document.getElementById("floatingInput").value
      const password = document.getElementById("floatingPassword").value

      const result = await fetch("/api/login", {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            username,
            password
          })
      }).then ((res) =>res.json())

      if (result.status === "ok"){
        //everything went well
        console.log ("Got the token: ", result.data)
        localStorage.setItem('token', result.data)
        alert("Success")
      } else {
        alert (result.error)

      }
    }
  </script>
  </body>
</html>
